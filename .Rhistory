pattern[-1]
pattern[-4]
pattern[-2]
str_sub(pattern,-6,-1)
str_sub(pattern,-4,-1)
str_sub(pattern,-5,-1)
str_sub(pattern,1,-5)
str_sub(pattern,1,-6)
filename <- paste0(str_sub(pattern,1,-6),".csv")
getwd()
write_csv(split,"../table.csv")
path("../",filename)
filename
file.path("../")
file.path("../",filename)
file.path("..",filename)
write_csv(split,filepath)
filepath <- file.path("..",filename)
write_csv(split,filepath)
library(tidyverse)
setwd("results/03_Output_Tables")
taxa<-"aves"
pattern<-paste0("SRAtab_",taxa,"*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
myfiles1 <- list()
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="values",1:colnumber)
}
table <- bind_rows(myfiles2)
filtered <- table %>% filter(depth!=0)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
filename <- paste0(str_sub(pattern,1,-6),".csv")
filepath <- file.path("..","04_Formatted_Tables",filename)
write_csv(split,filepath)
filepath
getwd()
library(tidyverse)
setwd("results/03_Output_Tables")
taxa<-"aves"
pattern<-paste0("SRAtab_",taxa,"*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
myfiles1 <- list()
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="values",1:colnumber)
}
table <- bind_rows(myfiles2)
filtered <- table %>% filter(values!=0)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
filename <- paste0(str_sub(pattern,1,-6),".csv")
filepath <- file.path("..","04_Formatted_Tables",filename)
write_csv(split,filepath)
library(tidyverse)
setwd("results/03_Output_Tables")
taxa<-"aves"
pattern<-paste0("SRAtab_",taxa,"*.csv")
pattern
pattern<-paste0("SRAtab_",taxa,"*.csv")
filenames <- Sys.glob(pattern)
filenames
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
myfiles1 <- list()
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="values",1:colnumber)
}
table <- bind_rows(myfiles2)
filtered <- table %>% filter(depth!=0)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
filename <- paste0(str_sub(pattern,1,-6),".csv")
setwd("results/03_Output_Tables")
pattern<-paste0("*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
View(myfiles)
filenames
setwd("results/03_Output_Tables")
pattern<-paste0("*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles[[i]]<-myfiles[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles[[i]])[2]-1
myfiles[[i]]<-myfiles[[i]] %>%
pivot_longer(names_to="SRAcode",values_to="values",1:colnumber) %>%
mutate(values=as.numeric(values))
}
myfiles <- bind_rows(myfiles) %>%
filter(values!=0) %>%
mutate(ID1=ID)
library(tidyverse)
setwd("results/03_Output_Tables")
pattern<-paste0("*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles[[i]]<-myfiles[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles[[i]])[2]-1
myfiles[[i]]<-myfiles[[i]] %>%
pivot_longer(names_to="SRAcode",values_to="values",1:colnumber) %>%
mutate(values=as.numeric(values))
}
myfiles <- bind_rows(myfiles) %>%
filter(values!=0) %>%
mutate(ID1=ID)
View(myfiles)
myfiles <- myfiles %>%  separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi")
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(Phylum!="unk_p")
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(order=="Saccharomycetales")
myfiles <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(Order=="Saccharomycetales")
View(myfiles)
pattern<-paste0("*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
for (i in 1:length(myfiles)){
myfiles[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles[[i]]<-myfiles[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles[[i]])[2]-1
myfiles[[i]]<-myfiles[[i]] %>%
pivot_longer(names_to="SRAcode",values_to="values",1:colnumber) %>%
mutate(values=as.numeric(values))
}
myfiles <- bind_rows(myfiles) %>%
filter(values!=0) %>%
mutate(ID1=ID)
myfiles <- myfiles %>%  separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi")
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(Genus=="Clavispora")
View(myfiles)
myfiles <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(Genus=="Clavispora") %>%
filter(Species=="[Candida] auris")
View(myfiles)
myfiles %>% select(SRA)
myfiles %>% select(SRA) %>% unique()
library(tidyverse)
setwd("results/03_Output_Tables")
pattern<-paste0("*.csv")
filenames <- Sys.glob(pattern)
taxa <- data.frame(filenames=filenames) %>%
separate(filenames,sep="_",into=c("SRA","taxa","type","values")) %>%
select(taxa)  %>% pull()
myfiles = lapply(filenames, read_csv)
names(myfiles) <- filenames
for (i in 1:length(myfiles)){
myfiles[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles[[i]]<-myfiles[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles[[i]])[2]-1
myfiles[[i]]<-myfiles[[i]] %>%
pivot_longer(names_to="SRAcode",values_to="values",1:colnumber) %>%
mutate(values=as.numeric(values))%>%
filter(values!=0) %>%
mutate(taxa=taxa[i])
}
myfiles <- bind_rows(myfiles) %>%
filter(values!=0) %>%
mutate(ID1=ID)
myfiles <- myfiles %>%  separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B) %>%
arrange(Genus)
myfiles %>% filter(Kingdom=="Fungi") %>%
arrange(Genus) %>% View()
positive_genus <- myfiles %>%
filter(Kingdom=="Fungi") %>%
filter(Genus=="Clavispora"|Genus=="Candida")
positive_species <- positive_genus %>%
filter(Species=="[Candida] auris")
positive_species %>% select(SRA) %>% unique()
genus_SRA <- positive_genus %>% select(SRA) %>% pull()
View(myfiles)
View(positive_genus)
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
geom_bar(position="fill")+
theme_minimal()
family_Palette <- c("#08519c","#2171b5","#4292c6","#6baed6","#c6dbef",
"#FFFFCC","#F2E5BB","#E5CCAA","#D8B29A","#CC9989","#BF7F79","#B26568",
"#A64C57","#993247","#8C1936","#800026")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
geom_bar(position="fill")+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), stat="identity", position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), stat="identity", position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), stat="fill", position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))
View(positive_species)
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles  %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles  %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Fungi), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal() +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal() +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "none")
myfiles  %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")+
ggtitle("Distribution of Saccharomycetales")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal() +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "none")+
ggtitle("Distribution of Fungi")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Saccharomycetales")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Saccharomycetales in environments with Candida/Clavispora")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal() +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "none")+
ggtitle("Distribution of Fungal orders in different environments")
myfiles  %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")+
ggtitle("Distribution of Saccharomycetales")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species,col="black"))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species,colour="black"), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")+
scale_fill_brewer(palette="OrRd")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
filename <- "results.csv"
filepath <- file.path("..","04_Formatted_Tables",filename)
write_csv(myfiles,filepath)
myfiles  %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "bottom")+
ggtitle("Distribution of Saccharomycetales families in all environments")
myfiles  %>%
filter(Kingdom=="Fungi")  %>%
ggplot(aes(x=taxa,fill=Order))+
theme_minimal() +
geom_bar(aes(fill=Order), position="stack") +
guides(fill=guide_legend(ncol=2))+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
theme(legend.position = "none")+
ggtitle("Distribution of Fungal orders in different all environments")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Order=="Saccharomycetales")  %>%
ggplot(aes(x=taxa,fill=Family))+
theme_minimal()+
scale_fill_manual(values=family_Palette) +
geom_bar(aes(fill=Family), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Saccharomycetales families in environments with Candida/Clavispora")
myfiles %>%
filter(SRA%in%genus_SRA) %>%
filter(Genus=="Clavispora"|Genus=="Candida")  %>%
ggplot(aes(x=taxa,fill=Species))+
theme_minimal() +
geom_bar(aes(fill=Species), position="stack") +
guides(fill=guide_legend(ncol=2))+
ggtitle("Distribution of Species in environments with Candida/Clavispora")
