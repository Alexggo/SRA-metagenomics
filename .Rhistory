library(tidyverse)
setwd("../results/03_Output_Tables")
setwd("results/03_Output_Tables")
taxa<-"aves"
pattern<-paste0("SRAtab_",taxa,"*.csv")
filenames <- Sys.glob(pattern)
myfiles = lapply(filenames, read_csv)
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))%>%pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
head(myfiles2[[i]])
}
myfiles1 <- list()
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))%>%pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
head(myfiles2[[i]])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
head(myfiles2[[i]])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
head(myfiles2[[i]])
}
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% head()
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% colnames()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% colnames() %>% select(colnumber)
}
dim(myfiles1[[1]])[2]-1
myfiles1 <- list()
myfiles2 <- list()
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% colnames()[colnumber]
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
v[colnumber]
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(v[colnumber])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(colnumber)
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(v)
print(colnumber)
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
colnumber<-dim(myfiles1[[i]])[2]-1
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(v)
print(colnumber)
print(v[colnumber])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(v)
print(colnumber)
print(v[colnumber])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(colnumber)
print(v[colnumber])
}
colnumber<-dim(myfiles2[[i]])[2]
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]]%>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]
#%>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(colnumber)
print(v[colnumber])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
v <- myfiles2[[i]] %>% colnames()
print(colnumber)
print(v[colnumber])
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% colnames()
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% colnames() %>% print()
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% head()
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
myfiles2[[i]] %>% head() %>% print()
}
for (i in 1:length(myfiles)){
myfiles1[[i]]<-myfiles[[i]] %>%
mutate(ID=paste(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species,sep="-"))
myfiles2[[i]]<-myfiles1[[i]] %>%select(-c(Superkingdom,Kingdom,Phylum,Class,Order,Family,Genus,Species))
colnumber<-dim(myfiles2[[i]])[2]-1
myfiles2[[i]]<-myfiles2[[i]] %>% pivot_longer(names_to="SRAcode",values_to="depth",1:colnumber)
}
bind_rows(myfiles2)
table <- bind_rows(myfiles2)
View(table)
table %>% filter(depth!=0)
filtered <- table %>% filter(depth!=0)
View(filtered)
filtered %>% separate(ID)
filtered %>% separate(ID,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-")
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-")
View(split)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separe(SRAcode,into=c('SRA',"2","3"),sep=".") %>%
select(-("2","3"))
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separe(SRAcode,into=c('SRA',"A","B"),sep=".") %>%
select(-c(A,B))
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep=".") %>%
select(-c(A,B))
View(split)
View(split)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B))
View(split)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B",sep="_")) %>% select(-B)
View(split)
split <- filtered %>% mutate(ID1=ID) %>% separate(ID1,into=c("Superkingdom","Kingdom","Phylum","Class","Order",
"Family","Genus","Species"),sep="-") %>%
separate(SRAcode,into=c('SRA',"A","B"),sep="\\.") %>%
select(-c(A,B)) %>%
separate(SRA,into=c("SRA","B"),sep="_") %>% select(-B)
View(split)
View(split)
pattern
pattern[-1]
pattern[-4]
pattern[-2]
str_sub(pattern,-6,-1)
str_sub(pattern,-4,-1)
str_sub(pattern,-5,-1)
str_sub(pattern,1,-5)
str_sub(pattern,1,-6)
filename <- paste0(str_sub(pattern,1,-6),".csv")
getwd()
write_csv(split,"../table.csv")
path("../",filename)
filename
file.path("../")
file.path("../",filename)
file.path("..",filename)
write_csv(split,filepath)
filepath <- file.path("..",filename)
write_csv(split,filepath)
